---
layout: default
title: Общие сведения
---

# Содержание

* [Введение](#введение)
* [Что такое Robot Operating System (ROS)?](#что-такое-ros)
* [Базовые понятия ROS](#базовые-понятия-ros)
* [Установка ROS](#установка-ros)
* [Рабочее пространство пользователя (воркспейс)](#рабочее-пространство-пользователя)

### Введение

Робототехническая платформа Вомбат предназначена, в первую очередь, для проверки и отладки алгоритмов управления и принятия решений, компьютерного зрения, обработки сенсорных данных, машинного обучения и проведения исследовательских работ.

Использование робота Вомбат облегчает решение связанных с аппаратной частью задач и позволяет сконцентрироваться на обработке сенсорных данных и формировании управляющих команд.

С описанием аппаратной части можно познакомиться в разделе ["Базовая платформа"](/wombat-robot-docs/docs/about/chassis.html) документации, а для размещения датчиков и иного оборудования предназначен [отсек для оборудования](/wombat-robot-docs/docs/about/user_space.html).

Робот Вомбат может поставляться с различными комплектами оборудования. Комплекты для картографирования содержат набор датчиков, достаточный для автономной навигации внутри помещений. На примере данных комплектов будет рассмотрен процесс установки [Robot Operating System (ROS)](http://www.ros.org/), конфигурирования и запуска пакетов [navigation](http://wiki.ros.org/navigation) в составе ROS. В результате робот будет способен перемещаться из текущей позиции в точку, заданную оператором на карте, объезжая при этом видимые препятствия.

## Что такое ROS?

ROS или Robot Operating System &mdash; набор программных библиотек и утилит, обеспечивающих взаимодействие между аппаратной и программной частями робота, а также между составляющими программной части. Иными словами, ROS является middleware &mdash; ПО промежуточного уровня, обеспечивающим инфраструктуру для общения между собой компонентов робота: контроллеров двигателей, бортового компьютерв и датчиков.

На сайте [wiki.ros.org](http://wiki.ros.org) содержится подробная документация и [обучающие примеры](http://wiki.ros.org/ROS/Tutorials) по работе с ROS.

### Почему ROS?

Робототехника и мехатроника являются сложными областями знаний, поэтому, чтобы получить значимый результат, специалисту необходимо разбираться сразу во множестве смежных отраслей знаний: математике и физике, программной инженерии, микроконтроллерах и схемотехнике, механике и многих других. Часть задач по разработке уже стала рутиной, например, подключение датчиков и реализация протоколов обмена данными, создание робототехнической платформы и т.п. Помимо этого, серьезными проблемами являются повторное использование кода и быстрая валидация опубликованных научных работ сторонними коллективами исследователей.

Для того, чтобы сравнить результаты работы алгоритмов, учёным приходилось реализовывать заново описанный в статьях математический аппарат и программные модули для преобразования форматов данных. Это занимало много времени и не всегда приводило к успеху. Выходом из данной ситуации являлась унификация взаимодействия программных модулей &mdash; создание единого стандарта общения между программами, написанными различными разработчиками, а также создание общего каталога программных модулей, где исследователи могут поделиться своими наработками или же опробовать созданные другими системы. Таким стандартом стал ROS.

Чтобы обеспечить совместимость программ, созданных различными разработчиками, в ROS были составлены соглашения, определяющие используемые понятия. Например, соглашение о системах координат [REP105](http://www.ros.org/reps/rep-0105.html) определяет именование и предназначение используемых систем координат, а также их взаимосвязь. Такая стандартизация позволяет существенным образом облегчить интеграцию новых алгоритмов в уже существующие системы, поскольку разработка изначально велась на основе одних и тех же понятий и стандартов.

Другим достоинством ROS является наличие общедоступной базы программных пакетов [ROS Index](https://index.ros.org/packages), содержащей пакеты для коммуникации с элементами информационно-измерительной системы робота, восприятия окружающей обстановки, принятия решений (например, планирования траектории) и т.п. Эти пакеты могут быть использованы в качестве строительных блоков при разработке собственной системы, что позволяет сосредоточиться на разработке только тех алгоритмов, которые представляют интерес. У ROS есть своя [вики](http://wiki.ros.org/), содержащая подробную информацию об установке и настройке ROS, входящих в ее состав пакетах и утилитах, их параметрах, использовании и т.д.

## Базовые понятия ROS
### Описание робота

Робот &mdash; это сложная система, состоящая из большего количества различных соединений, которые могут быть как статичными (например, крепление инерциального датчика к корпусу робота), так и подвижными (сочленение роборуки, крепление колес к оси и т.д.). Для описания взаимного расположения частей робота во времени используется механизм [tf](http://wiki.ros.org/tf). Благодаря библиотеке tf, пользователь имеет возможность узнать и задавать взаимное расположение частей робота в любой момент времени.

При помощи трансформаций между координатными системами (tf) определяется также и положение робота в пространстве (на карте, в мире).

#### Модель робота

Для визуализации робота в утилите [rviz](http://wiki.ros.org/rviz) и его симуляции в [gazebo](http://wiki.ros.org/gazebo_ros_pkgs) используется формат [URDF](http://wiki.ros.org/urdf). Файл в формате urdf описывает конструкцию робота, геометрические размеры отдельных его частей, их массы, моменты инерции и т.п. При помощи встроенных в ROS механизов формируются все соответствующие трансформации tf; для подвижных соединенией также возможно программное изменение их позиции.

### Пакет и ноды

В ROS программные компоненты распространяются в виде пакетов (_package_). Пакет [может содержать](http://wiki.ros.org/ROS/Concepts) в себе ноды (_node_), библиотеки (_library_), описание форматов сообщений (_messages_) и служб (_services_), наборы данных (_datasets_), параметры запуска (_launch files_).

[Нода](http://wiki.ros.org/Nodes) представляет собой некоторую программу, предназначенную для решения одной задачи. Для компиляции ноды из ее исходного кода используется система сборки [catkin](wiki.ros.org/catkin). В настоящий момент ROS поддерживает два основных языка программирования: C++ и Python. Для запуска нод используются, как правило, утилиты [rosrun](wiki.ros.org/rosrun) и [roslaunch](wiki.ros.org/roslaunch).

[Сообщения](http://wiki.ros.org/Messages) и [службы](http://wiki.ros.org/Services) представляют собой типы данных, используемые для обмена данными между запущенными нодами. Сообщения представляют собой способ асинхронной негарантированной связи: нода-отправитель не знает ни количества, ни идентификаторов получателей сообщения. Службы, наоборот, являются синхронными и, кроме того, помимо полей запроса могут содержать еще и поля ответа. При использовании механизма служб нода-отправитель ожидает результата своего запроса: был ли он доставлен, что было отвечено получателем. Только получив тот или иной ответ, она продолжает свою работу. В ROS существует значительное количество встроенных сообщений и служб, объединенных в пакеты. Например, [sensor_msgs](wiki.ros.org/sensor_msgs), используемые для передачи данных от различных датчиков. В случае, если стандартных типов недостаточно, пользователь может создать свои типы, описывающие необходимые ему форматы данных.

## Установка ROS

Основной операционной системой для работы ROS является Ubuntu; ROS также может работать с Debian, Windows, OS X и Android, однако работа в этих окружениях поддерживается не полностью и в целом менее стабильна, поэтому не рекомендуется начинающим. Новый релиз ROS выходит каждый год и поддерживает как актуальный релиз Ubuntu с долгосрочной поддержкой (LTS), так и один или два регулярных релиза Ubuntu. Установка произвольного релиза ROS в рамках произвольного релиза Ubuntu возможна, однако сопряжена с установкой и сборкой системы из исходного кода и не рекомендуется начинающим пользователям. Таким образом, выбор релиза ROS определяется используемой ОС, либо же выбор ОС определяется желаемым релизом ROS.

Актуальным на данный момент релизом ROS является [Melodic Morenia](http://wiki.ros.org/melodic), предполагающий использование с Ubuntu 18.04 LTS. Таким образом, поддержка Melodic Morenia закончится вместе с поддержкой Ubuntu 18.04 в 2023 году. Рассмотрим процесс установки этого релиза, описанный также в [официальной документации](http://wiki.ros.org/melodic/Installation/Ubuntu); установка других релизов ROS отличается только именем релиза в названиях устанавливаемых пакетов.

#### 1. Настройка репозиториев Ubuntu
Ubuntu должна быть сконфигурирована таким образом, чтобы позволять установку пакетов из репозиториев, помеченных как "restricted," "universe," и "multiverse".

#### 2. Добавление репозиториев ROS
Репозитории ROS, из которых Ubuntu будет получать необходимые пакеты, не сконфигурированы по умолчанию при установке системы, поэтому необходимо указать источник для скачивания этих пакетов:

```bash
sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list'
```
#### 3. Настройка GPG-ключей
Для подтверждения подлинности скачанных файлов в Ubuntu используется шифрование [GPG](https://ru.wikipedia.org/wiki/GnuPG), поэтому необходимо указать системе публичный ключ для проверки устанавливаемых пакетов.

```bash
sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
```

#### 4. Установка пакетов ROS
Перед началом установки пакетов ROS необходимо обновить информацию о содержимом репозиториев Ubuntu при помощи команды
```bash
sudo apt update
```

Также рекомендуется обновить уже установленные пакеты при помощи команды
```bash
sudo apt upgrade
```

ROS содержит большое количество пакетов, многие из которых являются ключевыми и необходимы для обеспечения базовой функциональности системы, а другие используются весьма редко. Поэтому есть несколько предварительно созданных конфигураций пакетов, обеспечивающих более или менее полную сборку ROS. Также возможна установка ROS через установку каждого пакета отдельно, что не рекомендуется начинающим пользователям. 

Наиболее удобной для использования является сборка Desktop Full, содержащая все базовые пакеты, утилиты визуализации rviz и rqt, пакеты драйверов датчиков и обработки поступающей с них информации. Это наиболее полная сборка, содержщая все основные пакеты ROS. Для ее установки используется команда

```bash
sudo apt install ros-melodic-desktop-full
```

В случае, если устанавливается ROS Lunar Loggerhead, команда будет иметь вид

```bash
sudo apt install ros-lunar-desktop-full
```

Таким образом, имя сборки формируется из префиксов "ros", <релиз> и <имя-сборки>, перечисленных через дефис. Аналогичным образом формируется имя пакета (вместо имени сборки указывается название пакета) и команда для его установки. Установка пакетов возможна как во время установки ROS, так и в любой момент после. Например, для установки пакета [mrpt_slam](http://wiki.ros.org/mrpt_slam) команда будет иметь вид:

```bash
sudo apt install ros-melodic-mrpt-slam
```

#### 5. Инициализация rosdep
rosdep &mdash; это утилита для разрешения зависимостей в исходном коде пакетов. Чтобы установить ее, необходимо последовательно выполнить команды:

```bash
sudo rosdep init
rosdep update
```

#### 6. Настройка окружения
Чтобы каждое новое окно терминала содержало переменные ROS и могло в полной мере с ним взаимодействовать, необходимо модифицировать файл .bashrc следующим образом:
```bash
echo "source /opt/ros/melodic/setup.bash" >> ~/.bashrc
source ~/.bashrc
```

## Рабочее пространство пользователя

Приведенных выше шагов достаточно для работы с пакетами, установленными при помощи пакетного менеджера (apt или apt-get). Однако рано или поздно появляется необходимость создать собственный пакет либо установить чей-то пакет из исходного кода. В этом случае требуется создать рабочее пространство пользователя (воркспейс), куда и будут помещены все пакеты, собираемые из исходного кода. 

Воркспейс представляет из себя иерархию каталогов, состоящую из нескольких уровней. Каталог верхнего уровня (как правило, он называется _catkin_ws_  и располагается в домашнем каталоге пользователя) содержит в себе каталоги исходного кода и сборки, в которых хранятся как файлы пользователя (исходный код, скомпилированные ноды), так и служебные файлы (промежуточные результаты сборки, логи систем сборки, настроечные файлы). Исходный код пользовательских пакетов располагается в каталоге _src_, а остальные файлы хранятся в каталогах _build_ и _devel_, которые генерируются автоматически.

#### Создание воркспейса
Для создания воркспейса необходимо создать корневой каталог воркспейса (назовем его _catkin_ws_) и его подкаталог _src_. Это можно сделать при помощи команды mkdir с параметром -p, в результате чего будет создана не одна папка, а заданная иерархия:

```bash
mkdir -p catkin_ws/src
```

Затем необходимо инициализировать воркспейс **из каталога _src_**. Для этого достаточно выполнить следующие команды: 

```bash
cd catkin_ws/src
catkin_init_workspace
```

Теперь _catkin_ws_ представляет собой воркспейс ROS, в каталоге _src_ которого можно размещать пользовательские пакеты в формате исходного кода. 

#### Сборка воркспейса
Так как внутри воркспейса расположены исходные коды пакетов, их необходимо преобразовать в исполняемые файлы. Для этого используется основанная на CMake система сборки [catkin](http://wiki.ros.org/catkin). Сборка воркспейса осуществляется в каталоге _catkin_ws_ при помощи команды _catkin_make_, которую необходимо использовать после установки новых пакетов из исходного кода или изменения исходного кода пакетов. В общем случае для сборки используется команда без параметров:

```bash
catkin_make
```

В ряде случаев бывает полезно указать количество параллельных процессов сборки, что делается при помощи опции -j. Так, для сборки в двух потоках команда будет иметь вид:

```bash
catkin_make -j2
```

В процессе своей работы _catkin_make_ создает каталоги _build_ и _devel_, если они еще не были созданы. Если возникает необходимость в полной очистке воркспейса (удалении всех результатов сборки и промежуточных файлов), то используется команда _catkin_make_ _clean_:

```bash
catkin_make clean
```

В крайних случаях можно полностью удалить каталоги _build_ и _devel_ внутри каталога _catkin_ws_. Сделать это можно как через оконный интерфейс, так и командой _rm_:
```bash
rm -rf build/ devel/
```

#### Работа с воркспейсом
Для того, чтобы расположенные в воркспейсе пакеты были видны системе ROS и могли ей использоваться, необходимо в каждом окне терминала, используемом для работы с ROS, выполнять команду подключения соответствующих переменных среды:
```bash
source /home/$USER/catkin_ws/devel/setup.bash
```

Если в рамках системы используется только один воркспейс, этого можно избежать, единожды указав путь к воркспейсу в файле _.bashrc_. Как правило, это является лучшим решением, так как параллельное использование нескольких воркспейсов требуется достаточно редко. Чтобы прописать путь к воркспейсу для всех открывающихся окон терминала, можно воспользоваться командой

```bash
echo "source /home/$USER/catkin_ws/devel/setup.bash" >> ~/.bashrc
```

В процессе выполнения команды переменная $USER будет автоматически заменена на имя пользователя, от имени которого выполняется команда. Любое открытое после этого окно терминала сможет работать с пакетами ROS, установленными как при помощи пакетного менеджера, так и из исходного кода. 
Путь к файлу, используемому для настройки работы с содержимым воркспейса, располагается внутри его подпапки _devel_. В случае, если этот файл не существует, при открытии окна терминала будет выводиться предупреждение. Чтобы создать файл _setup.bash_, необходимо выполнить [сборку воркспейса](#сборка-воркспейса); наличие пакетов в воркспейсе значения не имеет.

Если возникнет необходимость в смене имени воркспейса или отключении автоматической его "подгрузки", можно отредактировать скрытый файл _.bashrc_, расположенный в домашнем каталоге пользователя, модифицировав или вовсе убрав соответствующую строку.
